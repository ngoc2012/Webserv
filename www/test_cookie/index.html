<!DOCTYPE html>
<html>
    <head>
        <title>Blip Bloup</title>
    </head>
    <body>
        <h1>Blip Bloup</h1>
        <button id="button" onclick="send_get_request('signup')">signup</button>
        <button id="button" onclick="send_get_request('signout')">signout</button>
        Login: <input name="searchTxt" type="text" maxlength="512" id="login"/>
        Password: <input name="searchTxt" type="text" maxlength="512" id="password"/>
        <ul></ul>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script>
            //                    body: JSON.stringify('{ "action": "signup", "name": "bubulle2", "password": "1234" }'),
            document.cookie = "session_id=123456; expires=Thu, 01 Jan 2025 00:00:00 UTC; path=/; SameSite=None; Secure";

            function send_get_request(action)
            {
                login = document.getElementById('login').value;
                password = document.getElementById('password').value;
                const data = {
                    "action": action,
                    "name": login,
                    "password": password
                };
                fetch("http://127.0.0.1:4141/login.js", {
                    method: 'POST',
                    headers: {'Cookie': document.cookie},
                    credentials: 'include',
                    contentType: 'application/json',
                    body: JSON.stringify(data),
                    crossDomain: true,
                })
                .then(response => response.json())
                .then(response => {
                    console.log(response);
                    const setCookieHeader = response.headers.get('set-cookies');
                    //const setCookieHeader = "session_id=1; path=/"
                    //console.log(response);
                    //console.log(setCookieHeader);
                    //console.log(document.cookie);

                    if (setCookieHeader)
                    {
                        cookies = parseCookies(setCookieHeader);
                        console.log(cookies);
                        alert("Cookie found - token: " + cookies.session_id);
                        document.cookie = "session_id=" + cookies.session_id + "; expires=Thu, 01 Jan 2025 00:00:00 UTC; path=/; SameSite=None; Secure";
                        //console.log(document.cookie);
                    }
                    else
                        alert("No cookies");

                })
                .catch(error => {});
            }

            function parseCookies(setCookieHeader) {
              return setCookieHeader
                .split(';')
                .map(cookie => cookie.trim().split('='))
                .reduce((acc, [key, value]) => {
                  acc[key] = value;
                  return acc;
                }, {});
            }




            /*
            function send_post_request()
            {
                $.ajax({
                    type: "POST",
                    url: "http://127.0.0.1:4141",
                    async: true,
                    success: function(data)
                    {
                        alert(data);
                    }
                });
            }
            */
                           /*
                $.ajax({
                type: "GET",
                url: "http://127.0.0.1:4141",
                async: true,
                }).done(function () {
                    alert("Request GET success");
                })
                .fail(function () {
                    alert("Request GET fail");
                });
                */
        </script>
    </body>
</html>
